<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÄ‡∏Å‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Æ‡∏µ‡πÇ‡∏£‡πà ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
<style>
body{font-family:'Noto Sans Thai',sans-serif;background:#02101a;color:#fff;margin:0;padding:0;text-align:center;}
#gamePanel{padding:10px;}
#hpHeroBar,#hpBossBar{height:20px;background:green;width:100%;}
#log{max-height:150px;overflow-y:auto;text-align:left;border:1px solid #fff;margin:5px;padding:5px;}
#questionPanel{display:none;border:1px solid #fff;padding:5px;margin:5px;}
canvas{background:#02101a;display:block;margin:10px auto;}
button{margin:5px;padding:5px 10px;font-size:16px;}
#victory{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;color:#000;padding:20px;font-size:24px;border-radius:10px;}
</style>
</head>
<body>

<div id="gamePanel">
  <h1>‡πÄ‡∏Å‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Æ‡∏µ‡πÇ‡∏£‡πà ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
  <div>‡∏ó‡∏≠‡∏á: <span id="gold">0</span></div>
  <div>HP ‡∏Æ‡∏µ‡πÇ‡∏£‡πà: <span id="hpHeroText">0</span></div>
  <div id="hpHeroBar"></div>
  <div>HP ‡∏ö‡∏≠‡∏™: <span id="hpBossText">0</span></div>
  <div id="hpBossBar"></div>
  <div>‡∏î‡πà‡∏≤‡∏ô‡∏ö‡∏≠‡∏™: <span id="bossStage">1</span></div>
  <div>‡∏ö‡∏±‡∏û: <span id="buffs">‡πÑ‡∏°‡πà‡∏°‡∏µ</span></div>
  <canvas id="c" width="600" height="300"></canvas>
  <div id="log"></div>

  <div>
    <button data-item="potion">‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ +50HP (30 ‡∏ó‡∏≠‡∏á)</button>
    <button data-item="sword">‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡∏≤‡∏ö‡∏´‡∏ô‡∏±‡∏Å (80 ‡∏ó‡∏≠‡∏á)</button>
    <button id="startBossBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™</button>
    <button id="surrenderBtn">‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ</button>
  </div>

  <div id="questionPanel">
    <div id="qText"></div>
    <div id="qChoices"></div>
    <button id="answerBtn">‡∏ï‡∏≠‡∏ö</button>
    <button id="skipBtn">‡∏Ç‡πâ‡∏≤‡∏°</button>
  </div>

  <h2>Leaderboard</h2>
  <div id="leaderboard"></div>
</div>

<div id="victory">Victory! üéÜ</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyC4a9DrCeSN_HQFIHXWJhnzN4Jn376CdIc",
  authDomain: "hero-4ebbe.firebaseapp.com",
  databaseURL: "https://hero-4ebbe-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "hero-4ebbe",
  storageBucket: "hero-4ebbe.firebasestorage.app",
  messagingSenderId: "868857385644",
  appId: "1:868857385644:web:d5366bee7f5d7b11e60509",
  measurementId: "G-2DE96HJN7Z"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= Player =================
let playerName = "";
while(!playerName){
  playerName = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:","‡∏ú‡∏π‡πâ‡∏Å‡∏•‡πâ‡∏≤");
  if(!playerName) alert("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!");
}

const state={gold:60,hp:100,maxhp:100,bossStage:1,bossHP:0,bossMax:0,buffs:{sword:0},inFight:false,log:[],timeStart:0};

const goldEl=document.getElementById('gold'),
      hpHeroBar=document.getElementById('hpHeroBar'),
      hpHeroText=document.getElementById('hpHeroText'),
      hpBossBar=document.getElementById('hpBossBar'),
      hpBossText=document.getElementById('hpBossText'),
      buffsEl=document.getElementById('buffs'),
      bossStageEl=document.getElementById('bossStage'),
      logEl=document.getElementById('log'),
      qPanel=document.getElementById('questionPanel'),
      qText=document.getElementById('qText'),
      qChoices=document.getElementById('qChoices'),
      c=document.getElementById('c'),
      ctx=c.getContext('2d'),
      leaderboardEl=document.getElementById('leaderboard');

// ================= Images =================
const heroImg = new Image();
heroImg.src = 'hero.png';
const bossImg = new Image();
bossImg.src = 'boss.png';

// ================= Questions =================
const questions=[
  {q:'‡∏á‡∏ö‡∏î‡∏∏‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢?',choices:['‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå/‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô','‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢','‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î'],a:0,diff:'easy'},
  {q:'‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô?',choices:['‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î','‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô','‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ'],a:1,diff:'medium'},
  {q:'‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏∏‡∏ô‡πÅ‡∏™‡∏î‡∏á?',choices:['‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á','‡∏´‡∏ô‡∏µ‡πâ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å','‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'],a:0,diff:'hard'},
  {q:'‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô?',choices:['‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤','‡∏Ñ‡πà‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ','‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'],a:1,diff:'easy'},
  {q:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?',choices:['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì','‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢','‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ú‡∏±‡∏ô‡πÅ‡∏õ‡∏£'],a:0,diff:'medium'},
  {q:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£?',choices:['‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤','‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô','‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å'],a:0,diff:'easy'},
  {q:'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?',choices:['‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ','‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏õ‡∏µ','‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢'],a:0,diff:'medium'},
  {q:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏î‡∏à‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≤‡∏¢?',choices:['‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô','‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏¥‡∏ï','‡∏Ñ‡πà‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ'],a:1,diff:'medium'}
];
function goldByDiff(d){if(d==='easy')return 20;if(d==='medium')return 40;return 60;}

// ================= Save & Log =================
function save(){
  goldEl.textContent=state.gold;
  hpHeroBar.style.width = (state.hp/state.maxhp*100)+'%';
  if(state.hp/state.maxhp>0.6) hpHeroBar.style.backgroundColor='green';
  else if(state.hp/state.maxhp>0.3) hpHeroBar.style.backgroundColor='yellow';
  else hpHeroBar.style.backgroundColor='red';
  hpHeroText.textContent=state.hp+' / '+state.maxhp;

  hpBossBar.style.width=(state.bossMax?state.bossHP/state.bossMax*100:0)+'%';
  hpBossText.textContent=state.bossHP+' / '+state.bossMax;

  buffsEl.textContent=state.buffs.sword?'‡∏î‡∏≤‡∏ö‡∏ä‡∏≤‡∏£‡πå‡∏à':'‡πÑ‡∏°‡πà‡∏°‡∏µ';
  bossStageEl.textContent=state.bossStage;
  renderLog();
}
function addLog(t){state.log.unshift(t);if(state.log.length>50)state.log.pop();renderLog();}
function renderLog(){logEl.innerHTML=state.log.map(s=>'<div>'+s+'</div>').join('');}

// ================= Draw Scene =================
function drawScene(heroShake=0,bossShake=0){
  ctx.clearRect(0,0,c.width,c.height);
  ctx.fillStyle='#02101a';
  ctx.fillRect(0,0,c.width,c.height);
  ctx.drawImage(heroImg,100+(Math.random()-0.5)*heroShake,130,50,50);
  ctx.drawImage(bossImg,450+(Math.random()-0.5)*bossShake,100,100,100);
}

function animateAttack(type){
  let t=0;
  const timer=setInterval(()=>{
    t++;
    if(type==='hero') drawScene(12,0);
    if(type==='boss') drawScene(0,12);
    if(t>8){clearInterval(timer);drawScene();}
  },40);
}

// ================= Game Logic =================
let currentQuestion=null;
let questionPool=[...questions];

function newBoss(){
  if(!heroImg.complete || !bossImg.complete){
    addLog('‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û...');
    setTimeout(newBoss,100); return;
  }
  state.inFight=true;
  state.bossMax=500; state.bossHP=state.bossMax;
  addLog('‡∏ö‡∏≠‡∏™‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÅ‡∏•‡πâ‡∏ß! ‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞!');
  state.timeStart=Date.now();
  save(); drawScene(); showQuestion();
}

function showQuestion(){
  if(questionPool.length===0) questionPool=[...questions];
  const idx=Math.floor(Math.random()*questionPool.length);
  currentQuestion=questionPool.splice(idx,1)[0];
  qPanel.style.display='block';
  qText.textContent='['+currentQuestion.diff+'] '+currentQuestion.q;
  qChoices.innerHTML=currentQuestion.choices.map((c,i)=>`<div><label><input type=radio name=ans value=${i}> ${c}</label></div>`).join('');
}

// ================= Buttons =================
document.getElementById('answerBtn').onclick=()=>{
  const sel=[...document.getElementsByName('ans')].find(r=>r.checked);if(!sel)return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô!");
  const idx=Number(sel.value); qPanel.style.display='none';
  if(idx===currentQuestion.a){
    const dmg=state.buffs.sword?25:10;
    state.bossHP=Math.max(0,state.bossHP-dmg);
    state.gold+=goldByDiff(currentQuestion.diff);
    addLog('‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! ‡πÇ‡∏à‡∏°‡∏ï‡∏µ -'+dmg);
    state.buffs.sword=0;
    animateAttack('hero');
    if(state.bossHP<=0) return victory();
  }else{
    state.hp=Math.max(0,state.hp-20);
    addLog('‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡∏ö‡∏≠‡∏™‡∏ï‡∏µ -20');
    animateAttack('boss');
    if(state.hp<=0) return gameOver();
  }
  save(); setTimeout(showQuestion,600);
};

document.getElementById('skipBtn').onclick=()=>{
  qPanel.style.display='none';
  state.hp=Math.max(0,state.hp-20);
  addLog('‡∏Ç‡πâ‡∏≤‡∏°! ‡∏ö‡∏≠‡∏™‡∏ï‡∏µ -20');
  animateAttack('boss');
  if(state.hp<=0) return gameOver();
  save(); setTimeout(showQuestion,600);
};

document.querySelectorAll('[data-item]').forEach(b=>b.onclick=()=>{
  const it=b.dataset.item;
  if(it==='potion'){if(state.gold<30){addLog('‡∏ó‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠');return;}state.gold-=30;state.hp=Math.min(state.maxhp,state.hp+50);addLog('‡πÉ‡∏ä‡πâ‡∏¢‡∏≤ +50 HP');}
  if(it==='sword'){if(state.gold<80){addLog('‡∏ó‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠');return;}state.gold-=80;state.buffs.sword=1;addLog('‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡∏≤‡∏ö‡∏´‡∏ô‡∏±‡∏Å');}
  save();
});

document.getElementById('startBossBtn').onclick=newBoss;

document.getElementById('surrenderBtn').onclick=()=>{
  if(!state.inFight) return;
  state.inFight=false;
  state.hp=0;
  addLog('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏Å‡πà‡∏ô‡πâ‡∏≠‡∏¢ üê•');
  alert('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏Å‡πà‡∏ô‡πâ‡∏≠‡∏¢ üê•');
  save();
};

// ================= Victory / Game Over =================
function victory(){
  addLog('Victory! üéÜ');
  document.getElementById('victory').style.display='flex';
  state.inFight=false;
  const elapsed=Math.round((Date.now()-state.timeStart)/1000);
  db.ref('leaderboard').push({name:playerName,time:elapsed}).then(()=>loadLeaderboard());
  setTimeout(()=>{document.getElementById('victory').style.display='none';},2000);
  save();
}
function gameOver(){
  addLog('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ! üò¢');
  state.inFight=false;
  save();
}

// ================= Leaderboard =================
function loadLeaderboard(){
  db.ref('leaderboard').orderByChild('time').limitToFirst(10).once('value',snapshot=>{
    leaderboardEl.innerHTML='';
    snapshot.forEach(snap=>{
      const data=snap.val();
      leaderboardEl.innerHTML+=`<div>${data.name}: ${data.time}s</div>`;
    });
  });
}

save(); loadLeaderboard();
</script>

</body>
</html>
